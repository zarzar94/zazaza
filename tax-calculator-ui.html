<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>حاسبة الضرائب السورية</title>
  <style>
    /* Base styles */
    body { font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif; margin:0; padding:0; background:#fff; color:#1a5450; }
    /* Video background covers the entire viewport */
    #bgVideo { position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%; width: auto; height: auto; z-index: -1; object-fit: cover; }
    /* Wrap calculator UI to center it over the video */
    .calculator-container { position: relative; z-index: 1; display:flex; flex-direction: column; align-items:center; justify-content:center; min-height: 100vh; padding:20px; }
    h1 { margin-top:0; margin-bottom:20px; }
    label { display:block; margin-top:10px; font-weight:600; }
    input, select, button { width:100%; padding:8px; margin-top:4px; border:1px solid #ddd; border-radius:4px; font-size:14px; }
    button { background:#1a5450; color:#fff; cursor:pointer; }
    button:hover { background:#12423e; }
    /* Card-like sections with translucent backgrounds to reveal video */
    .section { margin-top:20px; padding:15px; border-radius:6px; background: rgba(255,255,255,0.85); border:1px solid rgba(255,255,255,0.4); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .hidden { display:none; }
    .result { margin-top:15px; padding:10px; background: rgba(255,255,255,0.85); border:1px solid rgba(255,255,255,0.4); border-radius:4px; white-space:pre-wrap; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    table { border-collapse: collapse; margin-top:20px; width:100%; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    th { background:#1a5450; color:#fff; }
    .highlight-min { background:#d4edda; color:#155724; font-weight:bold; }
  </style>
</head>
<body>
  <!-- Background video: muted and looping -->
  <video id="bgVideo" autoplay loop muted playsinline>
    <source src="background.mp4" type="video/mp4">
    متصفحك لا يدعم تشغيل الفيديو.
  </video>
  <!-- Calculator container wrapper to center the content -->
  <div class="calculator-container">
  <h1>حاسبة الضرائب السورية</h1>
  <label for="taxType">اختر نوع الضريبة:</label>
  <select id="taxType">
    <option value="" disabled selected>— اختر —</option>
    <option value="property">بيع عقار (قانون 15/2021)</option>
    <option value="rent">ضريبة الإيجار العقارية</option>
    <option value="profit">ضريبة الأرباح الحقيقية</option>
    <option value="lump">الدخل المقطوع</option>
    <option value="salary">ضريبة الرواتب والأجور</option>
    <option value="stamp">رسوم الطابع</option>
    <option value="profitCompare">مقارنة القوانين (24/51/30)</option>
  </select>

  <!-- ====== الأقسام ====== -->
  <div id="propertySection" class="section hidden">
    <h2>بيع عقار (القانون 15 لسنة 2021)</h2>
    <label>قيمة العقار (ل.س): <input type="number" id="propValue"></label>
    <label>نوع العقار:
      <select id="propType">
        <option value="residential">سكني</option>
        <option value="commercial">غير سكني (تجاري/صناعي)</option>
        <option value="landInside">أرض داخل المخطط</option>
        <option value="landOutside">أرض خارج المخطط</option>
        <option value="roof">سطح سكني</option>
      </select>
    </label>
    <label><input type="checkbox" id="propGiftRelatives"> هبة للأصول/الفروع/الزوج</label>
    <button id="propCalculate">احسب الضريبة</button>
    <div id="propResult" class="result hidden"></div>
  </div>

  <div id="rentSection" class="section hidden">
    <h2>ضريبة الإيجار العقارية</h2>
    <label>إجمالي بدل الإيجار (ل.س): <input type="number" id="rentValue"></label>
    <label>القيمة الرائجة (ل.س): <input type="number" id="rentPropValue"></label>
    <label><input type="checkbox" id="rentFurnished"> مفروش</label>
    <select id="rentUseSimple">
      <option value="residential">سكني</option>
      <option value="commercial">تجاري/غير سكني</option>
    </select>
    <button id="rentCalculate">احسب الضريبة</button>
    <div id="rentResult" class="result hidden"></div>
  </div>

  <div id="profitSection" class="section hidden">
    <h2>ضريبة الأرباح الحقيقية</h2>
    <label>صافي الربح السنوي (ل.س): <input type="number" id="profitValue"></label>
    <select id="profitTaxpayerType">
      <option value="individual">فرد/شركات أشخاص</option>
      <option value="corporate">شركة أموال</option>
    </select>
    <select id="profitCompanyType">
      <option value="jscPublic">شركة مساهمة عامة (>40% اكتتاب)</option>
      <option value="companyOther">باقي الشركات</option>
      <option value="bankInsurance">مصارف/تأمين</option>
      <option value="oilGas">نفط وغاز</option>
    </select>
    <button id="profitCalculate">احسب الضريبة</button>
    <div id="profitResult" class="result hidden"></div>
  </div>

  <div id="lumpSection" class="section hidden">
    <h2>الدخل المقطوع (تقديري)</h2>
    <label>رقم العمل السنوي (ل.س): <input type="number" id="lumpTurnover"></label>
    <label>هامش ربح تقديري %: <input type="number" id="lumpMargin" value="15"></label>
    <label>عدد السيارات (إن وجِد): <input type="number" id="lumpVehicles" value="0"></label>
    <button id="lumpCalculate">احسب الضريبة</button>
    <div id="lumpResult" class="result hidden"></div>
  </div>

  <div id="salarySection" class="section hidden">
    <h2>ضريبة الرواتب والأجور</h2>
    <label>الراتب الشهري الإجمالي (ل.س): <input type="number" id="salaryValue"></label>
    <label>تاريخ الاستحقاق:
      <select id="salaryDate">
        <option value="2023-09">من 1/9/2023 حتى 29/2/2024</option>
        <option value="2024-03">من 1/3/2024 وما بعد</option>
      </select>
    </label>
    <label><input type="checkbox" id="salaryLumpOption"> الضريبة المقطوعة (5%)</label>
    <button id="salaryCalculate">احسب الضريبة</button>
    <div id="salaryResult" class="result hidden"></div>
  </div>

  <div id="stampSection" class="section hidden">
    <h2>رسوم الطابع</h2>
    <label>الفئة:</label>
    <select id="stampCategory"></select>
    <label>قيمة الأساس (ل.س):</label>
    <input type="number" id="stampValue">
    <div id="stampCapitalContainer" class="hidden">
      <label>رأس المال (ل.س):</label>
      <input type="number" id="stampCapital">
    </div>
    <div id="stampPublicOfferContainer" class="hidden">
      <label><input type="checkbox" id="stampPublicOffer"> طرح أسهم للاكتتاب العام</label>
    </div>
    <label>عدد النسخ:</label>
    <input type="number" id="stampCopies" value="2">
    <button id="stampCalculate">احسب الرسوم</button>
    <div id="stampResult" class="result hidden"></div>
  </div>

  <div id="profitCompareSection" class="section hidden">
    <h2>مقارنة ضريبة الأرباح (قانون 24 / مرسوم 51 / مرسوم 30)</h2>
    <label>الربح السنوي (ل.س): <input type="number" id="compareProfit"></label>
    <button id="compareCalculate">احسب المقارنة</button>
    <table id="compareTable" class="hidden">
      <thead>
        <tr><th>النظام</th><th>الضريبة (ل.س)</th><th>النسبة من الربح</th></tr>
      </thead>
      <tbody>
        <tr><td>قانون 24</td><td id="law24Cell"></td><td id="law24Rate"></td></tr>
        <tr><td>مرسوم 51</td><td id="dec51Cell"></td><td id="dec51Rate"></td></tr>
        <tr><td>مرسوم 30 - مساهمة عامة</td><td id="dec30jscCell"></td><td id="dec30jscRate"></td></tr>
        <tr><td>مرسوم 30 - باقي الشركات</td><td id="dec30otherCell"></td><td id="dec30otherRate"></td></tr>
        <tr><td>مرسوم 30 - مصارف/تأمين</td><td id="dec30bankCell"></td><td id="dec30bankRate"></td></tr>
        <tr><td>مرسوم 30 - نفط وغاز</td><td id="dec30oilCell"></td><td id="dec30oilRate"></td></tr>
      </tbody>
    </table>
  </div>

  </div><!-- end calculator container -->
  <script>
  // منطق إظهار الأقسام
  document.getElementById('taxType').addEventListener('change', e=>{
    document.querySelectorAll('.section').forEach(sec=>sec.classList.add('hidden'));
    const sec = document.getElementById(e.target.value+'Section');
    if(sec) sec.classList.remove('hidden');
  });

  // ===== رسوم الطابع =====
  const STAMP_CATEGORIES = {
    general:{type:'percentage',rate:0.004,label:'عقد بمبلغ محدد'},
    guarantee:{type:'percentage',rate:0.003,label:'كفالة مالية'},
    insurance:{type:'fixed',amount:5000,label:'وثائق تأمين'},
    partnership:{type:'mixed',baseFee:25000,rate:0.005,label:'شركة أشخاص'},
    jointStock:{type:'mixed',rate:0.005,publicRate:0.0025,label:'شركة مساهمة'},
    llc:{type:'mixed',baseFee:25000,rate:0.005,label:'محدودة المسؤولية'},
    documentNoAmount:{type:'fixed',amount:5000,label:'وثيقة بلا مبلغ'}
  };
  function populateStamp(){
    const s=document.getElementById('stampCategory');
    s.innerHTML='';
    for(const k in STAMP_CATEGORIES){
      const o=document.createElement('option');
      o.value=k; o.textContent=STAMP_CATEGORIES[k].label;
      s.appendChild(o);
    }
  }
  populateStamp();

  document.getElementById('stampCalculate').addEventListener('click',()=>{
    const cat=STAMP_CATEGORIES[document.getElementById('stampCategory').value];
    const v=+document.getElementById('stampValue').value||0;
    const cap=+document.getElementById('stampCapital').value||0;
    const po=document.getElementById('stampPublicOffer')?.checked;
    const copies=+document.getElementById('stampCopies').value||1;
    let base=0;
    if(cat){
      if(cat.type==='percentage') base=v*cat.rate;
      else if(cat.type==='fixed') base=cat.amount;
      else if(cat.type==='mixed'){
        const r=(po&&cat.publicRate)?cat.publicRate:cat.rate;
        base=(cat.baseFee||0)+cap*r;
      }
    }
    const duty=base, nat=duty*0.10, loc=duty*0.05;
    const per=duty+nat+loc;
    const total=per*copies;
    let out=`الرسوم الأساسية: ${duty.toFixed(2)} ل.س\nالمساهمة الوطنية 10%: ${nat.toFixed(2)} ل.س\nرسم الإدارة المحلية 5%: ${loc.toFixed(2)} ل.س\nالإجمالي للنسخة الواحدة: ${per.toFixed(2)} ل.س`;
    if(copies>1) out+=`\nالإجمالي لجميع النسخ: ${total.toFixed(2)} ل.س`;
    const resultEl = document.getElementById('stampResult');
    resultEl.textContent=out;
    resultEl.classList.remove('hidden');
  });

  // ===== البيوع العقارية =====
  const SALE_RATES = {residential:0.01,commercial:0.03,landInside:0.02,landOutside:0.01,roof:0.01};
  document.getElementById('propCalculate').addEventListener('click',()=>{
    const v=+document.getElementById('propValue').value||0;
    const t=document.getElementById('propType').value;
    const gift=document.getElementById('propGiftRelatives').checked;
    let base=v*(SALE_RATES[t]||0.01);
    if(gift) base*=0.15;
    const loc=base*0.10, rec=base*0.10, total=base+loc+rec;
    const resText=`الضريبة الأساسية: ${base.toFixed(2)} ل.س\nإدارة محلية: ${loc.toFixed(2)} ل.س\nإعادة إعمار: ${rec.toFixed(2)} ل.س\nالإجمالي: ${total.toFixed(2)} ل.س`;
    const resultEl=document.getElementById('propResult');
    resultEl.textContent=resText;
    resultEl.classList.remove('hidden');
  });

  // ===== الإيجارات =====
  document.getElementById('rentCalculate').addEventListener('click',()=>{
    const rent=+document.getElementById('rentValue').value||0;
    const val=+document.getElementById('rentPropValue').value||0;
    const use=document.getElementById('rentUseSimple').value;
    const furn=document.getElementById('rentFurnished').checked;
    const rate=use==='residential'?0.05:0.10;
    const minF=use==='residential'?0.0003:0.0006;
    const valueForMin=(use==='residential' && furn)?val*1.25:val;
    const tax=rent*rate;
    const min=valueForMin*minF;
    const due=Math.max(tax,min);
    const text=`من البدل: ${tax.toFixed(2)} ل.س\nالحد الأدنى: ${min.toFixed(2)} ل.س\nالمستحق: ${due.toFixed(2)} ل.س\nملاحظة: يجب التصريح خلال 30 يوماً، والغرامة 10% عند التأخير.`;
    const resEl=document.getElementById('rentResult');
    resEl.textContent=text;
    resEl.classList.remove('hidden');
  });

  // ===== الأرباح =====
  const BRACKETS2024=[{l:10000000,r:0.10},{l:30000000,r:0.14},{l:100000000,r:0.18},{l:500000000,r:0.22},{l:Infinity,r:0.25}];
  function calcInd2024(p){
    let t=Math.max(0,p-3000000), prev=0, sum=0;
    for(const b of BRACKETS2024){
      const cap=Math.min(t, b.l-prev);
      if(cap<=0) break;
      sum+=cap*b.r;
      t-=cap;
      prev=b.l;
    }
    return sum;
  }
  function calcCorp(p,type){
    const map={jscPublic:0.15,companyOther:0.20,bankInsurance:0.25,oilGas:0.35};
    return p*(map[type]||0.20);
  }
  document.getElementById('profitCalculate').addEventListener('click',()=>{
    const p=+document.getElementById('profitValue').value||0;
    const tp=document.getElementById('profitTaxpayerType').value;
    let base;
    if(tp==='individual') base=calcInd2024(p);
    else base=calcCorp(p, document.getElementById('profitCompanyType').value);
    const loc=base*0.10, rec=base*0.10, total=base+loc+rec;
    const text=`الأساسية: ${base.toFixed(2)} ل.س\nإدارة محلية: ${loc.toFixed(2)} ل.س\nإعمار: ${rec.toFixed(2)} ل.س\nالإجمالي: ${total.toFixed(2)} ل.س`;
    const resEl=document.getElementById('profitResult');
    resEl.textContent=text;
    resEl.classList.remove('hidden');
  });

  // ===== الدخل المقطوع =====
  document.getElementById('lumpCalculate').addEventListener('click',()=>{
    const t=+document.getElementById('lumpTurnover').value||0;
    const m=+document.getElementById('lumpMargin').value||0;
    const v=+document.getElementById('lumpVehicles').value||0;
    const profitEst=Math.max(0, (t*(m/100)) - (v*2000000));
    const base=calcInd2024(profitEst);
    const loc=base*0.10, rec=base*0.10;
    const total=base+loc+rec;
    const text=`الربح التقديري: ${profitEst.toFixed(2)} ل.س\nالأساسية: ${base.toFixed(2)} ل.س\nإدارة محلية: ${loc.toFixed(2)} ل.س\nإعمار: ${rec.toFixed(2)} ل.س\nالإجمالي: ${total.toFixed(2)} ل.س\nملاحظة: هذه نتيجة تقديرية.`;
    const resEl=document.getElementById('lumpResult');
    resEl.textContent=text;
    resEl.classList.remove('hidden');
  });

  // ===== الرواتب =====
  const salaryBrackets_2023_09=[
    {limit:250000, rate:0.05},
    {limit:450000, rate:0.07},
    {limit:650000, rate:0.09},
    {limit:850000, rate:0.11},
    {limit:1100000, rate:0.13},
    {limit:Infinity, rate:0.15}
  ];
  const salaryBrackets_2024_03=[
    {limit:450000, rate:0.07},
    {limit:650000, rate:0.09},
    {limit:850000, rate:0.11},
    {limit:1100000, rate:0.13},
    {limit:Infinity, rate:0.15}
  ];
  function calcSalaryTax(monthly, brackets){
    let remaining=monthly, prev=0, total=0;
    const details=[];
    for(const b of brackets){
      const cap=Math.min(remaining, b.limit - prev);
      if(cap<=0) break;
      total+=cap * b.rate;
      details.push({amount: cap, rate: b.rate, tax: cap*b.rate});
      remaining -= cap;
      prev = b.limit;
    }
    return {total, details};
  }
  document.getElementById('salaryCalculate').addEventListener('click',()=>{
    const income=+document.getElementById('salaryValue').value||0;
    const period=document.getElementById('salaryDate').value;
    const lump=document.getElementById('salaryLumpOption').checked;
    if(lump){
      const total=income*0.05;
      document.getElementById('salaryResult').textContent=`الراتب: ${income} ل.س\nالضريبة المقطوعة 5%: ${total.toFixed(2)} ل.س`;
      document.getElementById('salaryResult').classList.remove('hidden');
      return;
    }
    const brackets=(period==='2023-09')?salaryBrackets_2023_09:salaryBrackets_2024_03;
    const res=calcSalaryTax(income, brackets);
    let out='';
    res.details.forEach((d,i)=>{
      out += `شريحة ${i+1}: ${d.amount} ل.س بنسبة ${(d.rate*100).toFixed(0)}% = ${d.tax.toFixed(2)} ل.س\n`;
    });
    out += `الإجمالي: ${res.total.toFixed(2)} ل.س`;
    document.getElementById('salaryResult').textContent = out;
    document.getElementById('salaryResult').classList.remove('hidden');
  });

  // ===== مقارنة القوانين 24/51/30 =====
  function calcLaw24(p){
    let taxable=p-3000000;
    let prev=0, total=0;
    for(const b of BRACKETS2024){
      const cap=Math.min(taxable, b.l - prev);
      if(cap<=0) break;
      total+=cap*b.r;
      taxable -= cap;
      prev = b.l;
    }
    return total;
  }
  function calcDecree51(p){ return p * 0.28; }
  function calcDecree30(p,type){
    const map={jscPublic:0.15,companyOther:0.20,bankInsurance:0.25,oilGas:0.35};
    return p*(map[type] || 0.20);
  }
  document.getElementById('compareCalculate').addEventListener('click',()=>{
    const p=+document.getElementById('compareProfit').value||0;
    const law24=calcLaw24(p);
    const dec51=calcDecree51(p);
    const jsc=calcDecree30(p,'jscPublic');
    const other=calcDecree30(p,'companyOther');
    const bank=calcDecree30(p,'bankInsurance');
    const oil=calcDecree30(p,'oilGas');
    const values=[law24,dec51,jsc,other,bank,oil];
    const minVal=Math.min(...values);
    function updateCell(cellId, value, rateId){
      const cell=document.getElementById(cellId);
      const rateCell=document.getElementById(rateId);
      cell.textContent = value.toLocaleString();
      const eff=(value/p*100) || 0;
      rateCell.textContent = eff.toFixed(2) + '%';
      cell.classList.remove('highlight-min');
      rateCell.classList.remove('highlight-min');
      if(value===minVal){
        cell.classList.add('highlight-min');
        rateCell.classList.add('highlight-min');
      }
    }
    updateCell('law24Cell', law24, 'law24Rate');
    updateCell('dec51Cell', dec51, 'dec51Rate');
    updateCell('dec30jscCell', jsc, 'dec30jscRate');
    updateCell('dec30otherCell', other, 'dec30otherRate');
    updateCell('dec30bankCell', bank, 'dec30bankRate');
    updateCell('dec30oilCell', oil, 'dec30oilRate');
    document.getElementById('compareTable').classList.remove('hidden');
  });

  </script>
</body>
</html>
